#!/usr/bin/env sh

if command -v yabai >/dev/null 2>&1; then
  yabai -m config \
    mouse_follows_focus          off \
    focus_follows_mouse          off \
    display_arrangement_order    default \
    window_origin_display        default \
    window_placement             second_child \
    window_insertion_point       focused \
    window_zoom_persist          on \
    split_ratio                  0.50 \
    split_type                   auto \
    auto_balance                 off \
    layout                       bsp \
    window_gap                   10 \
    top_padding                  46 \
    bottom_padding               12 \
    left_padding                 12 \
    right_padding                12 \
    menubar_opacity              0.0 \
    window_shadow                off \
    window_animation_duration    0.15 \
    window_opacity_duration      0.10 \
    window_opacity               on \
    active_window_opacity        1.0 \
    normal_window_opacity        0.92 \
    insert_feedback_color        0xffb4befe \
    mouse_modifier               fn \
    mouse_action1                move \
    mouse_action2                resize \
    mouse_drop_action            swap

  yabai -m rule --add app="^System Settings$" manage=off
  yabai -m rule --add app="^System Information$" manage=off

  if command -v sketchybar >/dev/null 2>&1; then
    yabai -m signal --remove label=sketchybar_window_focused 2>/dev/null || true
    yabai -m signal --remove label=sketchybar_space_changed 2>/dev/null || true
    yabai -m signal --remove label=sketchybar_front_app 2>/dev/null || true

    yabai -m signal --add label=sketchybar_window_focused event=window_focused action="sketchybar --trigger yabai_window_focused"
    yabai -m signal --add label=sketchybar_space_changed event=space_changed action="sketchybar --trigger yabai_space_changed"
    yabai -m signal --add label=sketchybar_front_app event=application_front_switched action="sketchybar --trigger yabai_front_app_switched"
  fi

  YABAI_BIN="/Users/kell/Applications/Yabai.app/Contents/MacOS/yabai"
  if [ -x "$YABAI_BIN" ]; then
    yabai -m signal --remove label=yabai_sa_dock_restart 2>/dev/null || true
    yabai -m signal --add label=yabai_sa_dock_restart event=dock_did_restart action="sudo $YABAI_BIN --load-sa"
    sudo -n "$YABAI_BIN" --load-sa >/dev/null 2>&1 || true
  fi
fi
